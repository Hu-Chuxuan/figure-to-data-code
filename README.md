# Structure

There are three files: ``Plot.py``, ``Subplot.py``, ``SubplotConstructor.py``, and ``ImageCleaner.py``. The ``Plot`` in ``Plot.py`` controls the entire pipeline including interacting with the LLMs. 

The pipeline is as follows: 

1. Call ``ImageCleaner`` to preprocess the target image. 
2. Use ``SubplotConstructor`` to estimate axes and use LLM to select the correct axes to form the correct subplots (``DotPlot``, ``Histogram``, or ``Continuous`` in ``Subplot.py``). 
3. Call the corresponding method to estimate the data points in each subplot given their types (dot plot, histogram, or continuous). 
4. Use the LLM to organize the recognized data points into ``Curve``s. 
5. Output the extracted data points into a CSV file. 

Here is an example of the pipeline, which will be a method in the ``Plot``:

```python
# Find potential axes for the LLM's selection
constructor = SubplotConstructor()
x = constructor.estimate_ticks(image, "x")
y = constructor.estimate_ticks(image, "y")

# Assume that it has two subplots. 
# These three lines of codes are expected to be generated by the LLMs
subplots = []
subplots.append(DotPlot(x[0], y[0], x_ticks_0, y_ticks_0, "Subplot name 1"))
subplots.append(DotPlot(x[1], y[1], x_ticks_1, y_ticks_1, "Subplot name 2"))

for subplot in subplots:
    # All type of subplots have implemented an ``estimate`` method 
    # to extract all possible data points that will be stored in each subplot object
    subplot.estimate(image)
    # Want to use the LLM to separate curves. We will see how it goes
    subplot.organize_curves(curves)

# This method will output the results of subplots into a csv file
df = subplots2csv(subplots)
```

# NOTE 

To run InternVL models, modify the `modeling_internvl_chat.py` files to remove the `return_dict` argument in the `self.language_model.generate` function.

# TODO

- [ ] Clean image (``ImageCleaner.py: ImageCleaner``) and estimate axes (``SubplotConstructor.py: SubplotConstructor``)
- [ ] Estimate data points
    - [ ] Dot points (``Subplot.py: DotPlot``)
    - [ ] Histogram (``Subplot.py: Histogram``)
    - [ ] Continuous curves (``Subplot.py: Continuous``)
- [ ] Organize data points and output CSV files